<div class="container mt-4">
  <h3>Danh s√°ch ƒëi·ªÉm theo t·ª´ng sinh vi√™n</h3>

  <!-- T√¨m ki·∫øm -->
  <div class="input-group mb-3 w-50">
    <input type="text" [(ngModel)]="searchTerm" (ngModelChange)="applyFilter()" class="form-control" placeholder="üîç T√¨m theo m√£ SV ho·∫∑c t√™n SV" />
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="text-center my-5">
    <div class="spinner-border text-primary" role="status"></div>
  </div>

  <!-- D·ªØ li·ªáu -->
  <ng-container *ngIf="!loading && pagedGroups.length">
    <div *ngFor="let group of pagedGroups; let idx = index" class="mb-5">
      <h5 class="text-primary">
        {{ (currentPage - 1) * pageSize + idx + 1 }}. Sinh vi√™n: <strong>{{ group.studentName }}</strong> (M√£ SV: {{ group.studentId }})
      </h5>

      <table class="table table-bordered table-striped">
        <thead class="table-secondary">
          <tr>
            <th>#</th>
            <th>M√¥n h·ªçc</th>
            <th>Qu√° tr√¨nh</th>
            <th>Th√†nh ph·∫ßn</th>
            <th>ƒêi·ªÉm cu·ªëi</th>
            <th>ƒê·∫≠u</th>
            <th>H√†nh ƒë·ªông</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let score of group.scores; let i = index">
            <td>{{ i + 1 }}</td>
            <td>{{ score.subjectName }}</td>
            <td>{{ score.processPoint ?? '-' }}</td>
            <td>{{ score.componentPoint ?? '-' }}</td>
            <td>{{ score.finalPoint ?? '-' }}</td>
            <td>
              <span [ngClass]="{
                  'text-success': score.isPassed === true,
                  'text-danger': score.isPassed === false,
                  'text-muted': score.isPassed === null
                }">
                {{ score.isPassed === true ? '‚úî' : score.isPassed === false ? '‚úò' : '-' }}
              </span>
            </td>
            <td>
              <a class="btn btn-sm btn-primary"
                 [routerLink]="['/admin/scores/input']"
                 [queryParams]="{ studentId: score.studentId, subjectId: score.subjectId }">
                Ch·ªânh s·ª≠a
              </a>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <nav *ngIf="totalPages > 1" class="mt-4">
      <ul class="pagination justify-content-center">
        <li class="page-item" [class.disabled]="currentPage === 1">
          <a class="page-link" (click)="goToPage(currentPage - 1)">¬´</a>
        </li>
        <li class="page-item"
            *ngFor="let p of [].constructor(totalPages); let i = index"
            [class.active]="currentPage === i + 1">
          <a class="page-link" (click)="goToPage(i + 1)">{{ i + 1 }}</a>
        </li>
        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <a class="page-link" (click)="goToPage(currentPage + 1)">¬ª</a>
        </li>
      </ul>
    </nav>
  </ng-container>

  <!-- Kh√¥ng c√≥ d·ªØ li·ªáu -->
  <div *ngIf="!loading && !pagedGroups.length" class="alert alert-info">
    Kh√¥ng c√≥ d·ªØ li·ªáu ƒëi·ªÉm n√†o.
  </div>
</div>
